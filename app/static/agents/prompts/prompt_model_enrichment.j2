{% if model_name and brand_name %}
The user provided the following information about their piano model:

- Brand: "{{ brand_name }}"
- Model: "{{ model_name }}"
{% if category %}- Category: {{ category }}{% endif %}
{% if type %}- Type: {{ type }}{% endif %}
{% if size_cm %}- Size: {{ size_cm }} cm{% endif %}
{% if year_estimated %}- Estimated year: {{ year_estimated }}{% endif %}

Your task as a piano historian and model identifier is to determine the nature of this model.

Please analyze whether:

1. It exists officially in the manufacturer's catalog (e.g., Yamaha C7).
2. It is a commemorative, tribute, or marketing model (e.g., "Chopin", "Liszt").
3. It refers to a known historical instrument (e.g., a piano played by Chopin, identified by a serial number).

---

STANDARD PIANO SIZE REFERENCE (AUTHORITATIVE ‚Äì DO NOT OUTPUT)

Use the following size ranges as the canonical reference when determining the piano subtype.
Base the subtype primarily on size in centimeters.

Upright pianos (vertical):

- Spinet: 91‚Äì102 cm  
- Console: 103‚Äì109 cm  
- Studio upright: 110‚Äì123 cm  
- Full upright: 124‚Äì150 cm  

Grand pianos (horizontal):

- Baby grand: 130‚Äì155 cm  
- Medium grand: 156‚Äì170 cm  
- Parlor grand: 171‚Äì190 cm  
- Music room (semi-concert) grand: 191‚Äì220 cm  
- Concert grand: greater than 220 cm  

Decision rules:
- Never assign an upright subtype to a grand piano or vice versa.
- If the size is borderline, choose the closest standard category and mention uncertainty in "notes".
- If size cannot be reliably determined, keep "type" null.

---

üîÅ Output Requirements:

Start your reply with a valid strict JSON object in the format:

{
  "status": "found" | "not_found" | "informal_reference",
  "model": "{{ model_name }}",
  "category": "grand" | "upright" | null,
  "type": "concert grand" | "baby grand" | "studio upright" | ...,
  "size_cm": 140,
  "reference_serial_numbers": ["7267", "13819", "14810"],
  "notes": "Short explanation with historical or catalog context.",
  "source": "llm"
}

Then, after the JSON, provide a brief and accessible explanation
(maximum two short sentences) in plain text for the user interface.

The explanation must be concise, didactic, and historically accurate.

Do not use markdown or code blocks.
Do not explain the JSON format.
Just output the JSON, followed by the user-facing summary.
{% endif %}

---

LANGUAGE RULE

- The JSON object MUST always remain in English:
  - JSON keys
  - enum values
  - fixed fields such as "status", "category", "type"

- The explanatory text written AFTER the JSON (user-facing explanation)
  MUST be written in {{ user_lang | default("en") }}.

- If {{ user_lang }} is not provided or empty, default to English.

- Do NOT mix languages.
- Do NOT translate JSON keys or enum values.